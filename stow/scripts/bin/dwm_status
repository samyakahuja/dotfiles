#!/bin/bash

print_wifi() {
	ip=$(ip route get 8.8.8.8 2>/dev/null|grep -Eo 'src [0-9.]+'|grep -Eo '[0-9.]+')
	if=wlp3s0
		while IFS=$': \t' read -r label value
		do
			case $label in SSID) SSID=$value
				;;
			signal) SIGNAL=$value
				;;
		esac
	done < <(iw "$if" link)
	echo -e "🗼 $SSID 🕸️ $SIGNAL 🔢 $ip"
}

print_mem(){
    mem=$(grep -m1 'MemAvailable:' /proc/meminfo | awk '{print $2}')
	echo "🧠 $(bc <<< "scale=2; ($mem) / (1024 * 1024)")G"
}

print_volume(){
    volume="$(amixer get Master | tail -n1 | sed -r 's/.*\[(.*)%\].*/\1/')"
    state="$(amixer get Master | tail -n1 | sed -r 's/.*\[(.*)\].*/\1/')"
    if test $state == "off"
    then
        echo "🔇 $volume%"
    else
        echo "🔊 $volume%"
    fi
}

print_bat(){
    for battery in /sys/class/power_supply/BAT?
    do
        capacity=$(cat "$battery"/capacity 2> /dev/null) || break
        status=$(sed "s/[Dd]ischarging/🔋/;s/[Nn]ot charging/🛑/;s/[Cc]harging/🔌/;s/[Uu]nknown/❓/;s/[Ff]ull/⚡/" "$battery"/status)
        printf "%s%s%% " "$status" "$capacity"
    done
}

print_date(){
	#date "+%a %m-%d %T%:::z"
    echo "🕒 $(date "+%a %d %b %I:%M")"
}

while true
do
    xsetroot -name " $(print_volume) $(print_mem) $(print_wifi) $(print_bat) $(print_date)"
	sleep 1
done
